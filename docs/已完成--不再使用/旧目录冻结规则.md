# 旧目录冻结规则（Phase 0）

> 目标：**停止技术债继续增长**。旧链路只允许维稳，不允许继续承载新功能。

## 1. 适用范围
当前仓库中被标记为“待迁移/合并”的旧目录与旧模块（以《模块清单.md》为准）。

## 2. 冻结总原则
1. **只修 bug，不加功能**。
2. **新需求默认进入新分层目录（`app/domains/shared/infra`）**。
3. **任何临时兼容都必须有删除期限**（写入迁移台账）。

## 3. 允许的变更（Allowed）
- 线上/测试阻断 bug 修复。
- 安全问题修复。
- 构建失败修复（type/build）且不扩展旧链路能力。
- 注释、文档、类型补充（不改变功能语义）。

## 4. 禁止的变更（Blocked）
- 在旧目录新增业务功能或新流程入口。
- 新增跨层依赖（例如 UI 直接引用深层业务内部实现）。
- 用复制粘贴方式在旧目录“再造一个版本”的实现。
- 以“先这样凑合”为由新增长期 `any` 或魔法字符串。

## 5. 变更审批规则（PR 检查）
每个涉及旧目录的 PR 必须在描述中回答：
1. 本次是 bugfix 还是功能？（若为功能，必须迁到新目录）
2. 是否新增了旧链路耦合？（若是，必须给出拆除计划）
3. 是否登记迁移台账？（来源 -> 新文件 -> 预计删除时间）

若无法回答以上三项，则 PR 不合入。

## 6. 例外流程
如确实需要短期例外（例如发版窗口紧急修复）：
- 在 PR 中标注 `legacy-exception`。
- 明确回收期限（建议 <= 2 周）。
- 在迁移台账登记“例外原因 + 回收计划 + 负责人”。

## 7. 执行机制
- 每周一次“冻结巡检”：只看两件事
  - 旧目录新增代码量
  - 旧目录净删除代码量
- 目标：旧目录代码量单调下降，直到迁移完成。

## 8. 生效与维护
- 生效时间：即日。
- 维护人：项目 Owner + 本周值班开发。
- 变更此规则必须走 PR 且在周会上确认。
